OPTIMIZED REALTIME DETECTION WORKFLOW DIAGRAM
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FRONTEND (React - LiveDetect Component)     BACKEND (FastAPI - WebSocket Server)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         INITIALIZATION             â”‚     â”‚      CONNECTION MANAGER             â”‚
â”‚ 1. Component mounts               â”‚     â”‚ 1. Create ThreadPoolExecutor        â”‚
â”‚ 2. Check device type (mobile/desk)â”‚     â”‚    - 4 worker threads              â”‚
â”‚ 3. Request camera permissions     â”‚     â”‚ 2. Initialize data structures:      â”‚
â”‚ 4. Enumerate available cameras    â”‚     â”‚    - frame_queues: {client_id: dequeâ”‚
â”‚ 5. Set up state & refs           â”‚     â”‚    - processing_flags: {client_id}   â”‚
â”‚    - videoRef, canvasRef, wsRef  â”‚     â”‚    - last_processed: {client_id: ts} â”‚
â”‚    - streamRef, animationFrameRefâ”‚     â”‚    - frame_counter: {client_id}      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                                           â”‚
                  â”‚ POST /api/realtime/stream (WebSocket)    â”‚
                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
                  â”‚                                           â”‚
                  â”‚                                          â”‚â”‚ 3. Accept connection
                  â”‚                                          â”‚â”‚ 4. Generate client_id
                  â”‚                                          â”‚â”‚ 5. Initialize queues
                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                  â”‚        WebSocket connected               â”‚
                  â”‚                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    START DETECTION (User clicks)   â”‚     â”‚                                   â”‚
â”‚ 1. GetUserMedia() for camera      â”‚     â”‚                                   â”‚
â”‚ 2. Set videoRef.srcObject = streamâ”‚     â”‚                                   â”‚
â”‚ 3. video.play()                   â”‚     â”‚                                   â”‚
â”‚                                   â”‚     â”‚                                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚                                   â”‚
â”‚    â”‚    RENDER LOOP (30 FPS)  â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚  â”‚requestAnimationFrameâ”œâ”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â–¶â”‚                                   â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚         â”‚                 â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚         â–¼                 â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚  ctx.drawImage(video)     â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚  Draw video frame to canvasâ”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚                           â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚  â”‚ Draw detections     â”‚   â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚  â”‚ from detectionData   â”‚   â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚     â”‚                                   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚                                   â”‚
â”‚                                   â”‚     â”‚                                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚                                   â”‚
â”‚    â”‚    SEND LOOP (30 FPS)    â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚  setInterval(33ms)       â”‚   â”‚     â”‚                                   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚                                   â”‚
â”‚           â”‚                        â”‚     â”‚                                   â”‚
â”‚           â–¼                        â”‚     â”‚                                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚     â”‚                                   â”‚
â”‚    â”‚FRAME SKIPPINGâ”‚               â”‚     â”‚                                   â”‚
â”‚    â”‚ LOGIC        â”‚               â”‚     â”‚                                   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚     â”‚                                   â”‚
â”‚           â”‚                        â”‚     â”‚                                   â”‚
â”‚           â”œâ”€ frameCounter++        â”‚     â”‚                                   â”‚
â”‚           â”œâ”€ if counter % 15 != 0: â”‚     â”‚                                   â”‚
â”‚           â”‚    SKIP FRAME          â”‚     â”‚                                   â”‚
â”‚           â”œâ”€ timeSinceLast < 500ms:â”‚     â”‚                                   â”‚
â”‚           â”‚    SKIP FRAME          â”‚     â”‚                                   â”‚
â”‚           â””â”€ Send frame            â”‚     â”‚                                   â”‚
â”‚                                    â”‚     â”‚                                   â”‚
â”‚           canvas.toDataURL(0.6)    â”‚     â”‚                                   â”‚
â”‚           â””â”€ JPEG quality 60%      â”‚     â”‚                                   â”‚
â”‚                                    â”‚     â”‚                                   â”‚
â”‚    {"frame": "data:image/jpeg...", â”‚     â”‚                                   â”‚
â”‚     "timestamp": 1634567890.123}   â”‚     â”‚                                   â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â–¶â”‚                                   â”‚
â”‚                                    â”‚     â”‚                                   â”‚
â”‚                                    â”‚     â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                                    â”‚     â”‚â”‚   FRAME RECEIVED              â”‚â”‚
â”‚                                    â”‚     â”‚â”‚ 1. Decode base64 â†’ OpenCV     â”‚â”‚
â”‚                                    â”‚     â”‚â”‚ 2. Add to frame_queue         â”‚â”‚
â”‚                                    â”‚     â”‚â”‚    (deque, maxlen=2)          â”‚â”‚
â”‚                                    â”‚     â”‚â”‚    - Only keep latest 2 framesâ”‚â”‚
â”‚                                    â”‚     â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                    â”‚     â”‚             â”‚                    â”‚
â”‚                                    â”‚     â”‚             â–¼                    â”‚
â”‚                                    â”‚     â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                                    â”‚     â”‚â”‚  PROCESSING DECISION          â”‚â”‚
â”‚                                    â”‚     â”‚â”‚ 1. frame_counter[client]++    â”‚â”‚
â”‚                                    â”‚     â”‚â”‚ 2. if counter % 15 != 0:      â”‚â”‚
â”‚                                    â”‚     â”‚â”‚    {"status": "frame_received"}â”‚â”‚
â”‚                                    â”‚     â”‚â”‚ 3. time_since_last < 500ms:   â”‚â”‚
â”‚                                    â”‚     â”‚â”‚    SKIP PROCESSING            â”‚â”‚
â”‚                                    â”‚     â”‚â”‚ 4. if processing_flag[client]:â”‚â”‚
â”‚                                    â”‚     â”‚â”‚    SKIP (already processing)  â”‚â”‚
â”‚                                    â”‚     â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                    â”‚     â”‚             â”‚                    â”‚
â”‚                                    â”‚     â”‚             â–¼                    â”‚
â”‚                                    â”‚     â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                                    â”‚     â”‚â”‚  THREAD POOL PROCESSING       â”‚â”‚
â”‚                                    â”‚     â”‚â”‚ executor.submit(               â”‚â”‚
â”‚                                    â”‚     â”‚â”‚   process_frame_async,         â”‚â”‚
â”‚                                    â”‚     â”‚â”‚   frame, client_id, timestamp  â”‚â”‚
â”‚                                    â”‚     â”‚â”‚ )                              â”‚â”‚
â”‚                                    â”‚     â”‚â”‚                                â”‚â”‚
â”‚                                    â”‚     â”‚â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚                                    â”‚     â”‚â”‚  â”‚ Worker Thread 1         â”‚ â”‚â”‚
â”‚                                    â”‚     â”‚â”‚  â”‚ model(frame, conf=0.4)  â”‚ â”‚â”‚
â”‚                                    â”‚     â”‚â”‚  â”‚ â†’ Get detections         â”‚ â”‚â”‚
â”‚                                    â”‚     â”‚â”‚  â”‚ â†’ Classify fire/smoke    â”‚ â”‚â”‚
â”‚                                    â”‚     â”‚â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚                                    â”‚     â”‚â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚                                    â”‚     â”‚â”‚  â”‚ Worker Thread 2         â”‚ â”‚â”‚
â”‚                                    â”‚     â”‚â”‚  â”‚ model(frame, conf=0.4)  â”‚ â”‚â”‚
â”‚                                    â”‚     â”‚â”‚  â”‚ â†’ Get detections         â”‚ â”‚â”‚
â”‚                                    â”‚     â”‚â”‚  â”‚ â†’ Classify fire/smoke    â”‚ â”‚â”‚
â”‚                                    â”‚     â”‚â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚                                    â”‚     â”‚â”‚             ...               â”‚â”‚
â”‚                                    â”‚     â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                    â”‚     â”‚               â”‚                  â”‚
â”‚                                    â”‚     â”‚               â–¼                  â”‚
â”‚                                    â”‚     â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                                    â”‚     â”‚â”‚  POST-PROCESSING              â”‚â”‚
â”‚                                    â”‚     â”‚â”‚ 1. Draw boxes on frame        â”‚â”‚
â”‚                                    â”‚     â”‚â”‚ 2. Encode â†’ base64 (60% qual) â”‚â”‚
â”‚                                    â”‚     â”‚â”‚ 3. Create alert message       â”‚â”‚
â”‚                                    â”‚     â”‚â”‚ 4. Prepare response JSON      â”‚â”‚
â”‚                                    â”‚     â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                    â”‚     â”‚               â”‚                  â”‚
â”‚                                    â”‚     â”‚               â–¼                  â”‚
â”‚                                    â”‚     â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                                    â”‚     â”‚â”‚  SEND RESPONSE TO CLIENT      â”‚â”‚
â”‚                                    â”‚     â”‚â”‚ {                             â”‚â”‚
â”‚                                    â”‚     â”‚â”‚   "detections": [...],        â”‚â”‚
â”‚                                    â”‚     â”‚â”‚   "fire_detected": true,      â”‚â”‚
â”‚                                    â”‚     â”‚â”‚   "smoke_detected": false,    â”‚â”‚
â”‚                                    â”‚     â”‚â”‚   "alert": "ðŸ”¥ FIRE DETECTED!",â”‚â”‚
â”‚                                    â”‚     â”‚â”‚   "detection_count": 2,       â”‚â”‚
â”‚                                    â”‚     â”‚â”‚   "timestamp": 1634567890.123,â”‚â”‚
â”‚                                    â”‚     â”‚â”‚   "processing_time": 0.45,    â”‚â”‚
â”‚                                    â”‚     â”‚â”‚   "voice_alert": "...",       â”‚â”‚
â”‚                                    â”‚     â”‚â”‚   "annotated_frame": "data:..."â”‚â”‚
â”‚                                    â”‚     â”‚â”‚ }                             â”‚â”‚
â”‚                                    â”‚     â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                    â”‚     â”‚               â”‚                  â”‚
â”‚    <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                    â”‚     â”‚                                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚                                   â”‚
â”‚    â”‚   HANDLE RESPONSE        â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚ 1. Parse JSON            â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚ 2. Update state:         â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚    - detectionData       â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚    - fireDetected        â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚    - smokeDetected       â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚    - alert               â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚ 3. Update stats:         â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚    - framesProcessed++   â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚    - processingTimes     â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚ 4. If voice_enabled:     â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚    speechSynthesis.speak()â”‚   â”‚     â”‚                                   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚                                   â”‚
â”‚                                    â”‚     â”‚                                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚                                   â”‚
â”‚    â”‚    STATS UPDATE LOOP     â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚  setInterval(1000ms)     â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚ 1. Calculate current FPS â”‚   â”‚     â”‚                                   â”‚
â”‚    â”‚ 2. Update stats display  â”‚   â”‚     â”‚                                   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚                                   â”‚
â”‚                                    â”‚     â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATA FLOW SUMMARY                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FRONTEND â†’ BACKEND:                                                        â”‚
â”‚ 1. WebSocket connect                                                       â”‚
â”‚ 2. JPEG frames (base64, 60% quality)                                       â”‚
â”‚ 3. Frame metadata (timestamp)                                              â”‚
â”‚                                                                             â”‚
â”‚ BACKEND â†’ FRONTEND:                                                        â”‚
â”‚ 1. Acknowledgement {"status": "frame_received"} (for skipped frames)       â”‚
â”‚ 2. Detection results with:                                                 â”‚
â”‚    - Bounding boxes                                                        â”‚
â”‚    - Fire/smoke flags                                                      â”‚
â”‚    - Alert messages                                                        â”‚
â”‚    - Annotated frame (when detections found)                               â”‚
â”‚    - Processing statistics                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PERFORMANCE OPTIMIZATIONS                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. FRAME SKIPPING: Only process 2 FPS (skip 14/15 frames at 30 FPS)        â”‚
â”‚ 2. THREAD POOL: 4 workers process frames concurrently                      â”‚
â”‚ 3. FRAME QUEUE: Only keep latest 2 frames, drop old ones                   â”‚
â”‚ 4. MINIMUM INTERVAL: 500ms between processing for same client              â”‚
â”‚ 5. LOW QUALITY: 60% JPEG quality for faster encoding/decoding              â”‚
â”‚ 6. ANIMATION FRAMES: Smooth 30 FPS display using requestAnimationFrame     â”‚
â”‚ 7. SEPARATE LOOPS: Render (30 FPS) vs Send (30 FPS) vs Process (2 FPS)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      STATE MANAGEMENT                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FRONTEND STATE:                                                            â”‚
â”‚ - isRunning: Detection active                                              â”‚
â”‚ - detectionData: Latest detection results                                  â”‚
â”‚ - fireDetected/smokeDetected: Boolean flags                                â”‚
â”‚ - stats: Performance metrics (FPS, frames sent, etc.)                      â”‚
â”‚                                                                             â”‚
â”‚ BACKEND STATE (per client):                                                â”‚
â”‚ - frame_queue: deque(maxlen=2) - Latest frames                             â”‚
â”‚ - processing_flag: Boolean - Prevent concurrent processing                 â”‚
â”‚ - last_processed: Timestamp - Throttle processing                          â”‚
â”‚ - frame_counter: Integer - Skip frames                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
IMAGE UPLOAD DETECTION PROCESS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FRONTEND (React)                                    BACKEND (FastAPI)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. User selects image file
   â”‚
2. FileReader reads image â†’ creates base64 preview
   â”‚
3. User clicks "Detect Objects"
   â”‚
4. Create FormData with image file
   â”‚
5. Send POST request to:                â† HTTP POST /api/image/upload/combined
   - Endpoint: http://localhost:8000/api/image/upload/combined
   - Body: FormData with image file
   - Headers: multipart/form-data
   â”‚
   â”‚                                    â†’ 1. Validate file type (must be image)
   â”‚                                         â”‚
   â”‚                                         â”‚ 2. Read uploaded file bytes
   â”‚                                         â”‚
   â”‚                                         â”‚ 3. Convert original to base64
   â”‚                                         â”‚    for response
   â”‚                                         â”‚
   â”‚                                         â”‚ 4. Run YOLO inference:
   â”‚                                         â”‚    - Load model (conf=0.1)
   â”‚                                         â”‚    - Decode image â†’ OpenCV format
   â”‚                                         â”‚    - Detect fire/smoke
   â”‚                                         â”‚
   â”‚                                         â”‚ 5. Process results:
   â”‚                                         â”‚    - Extract bounding boxes
   â”‚                                         â”‚    - Set fire/smoke flags
   â”‚                                         â”‚    - Draw boxes on image
   â”‚                                         â”‚
   â”‚                                         â”‚ 6. Encode annotated image â†’ base64
   â”‚                                         â”‚
   â”‚                                    â† 7. Send JSON response:
   â”‚                                       {
   â”‚                                         "original_image": "data:image/jpeg;base64,...",
   â”‚                                         "annotated_image": "data:image/jpeg;base64,...",
   â”‚                                         "detections": [...],
   â”‚                                         "fire_detected": true/false,
   â”‚                                         "smoke_detected": true/false,
   â”‚                                         "filename": "...",
   â”‚                                         "detection_count": N
   â”‚                                       }
   â”‚
6. Receive response â†’
   â”‚
7. Update React state with:
   - fire/smoke flags
   - detection array
   - annotated image base64
   â”‚
8. Display results:
   - Show fire/smoke alerts
   - List detected objects
   - Side-by-side image comparison
   â”‚
9. Optional: Download processed images



VIDEO DETECTION PROCESS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FRONTEND (React)                                    BACKEND (FastAPI)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. User selects video file
   â”‚
2. User clicks "Upload Video"
   â”‚
3. Create FormData with video file
   â”‚
4. Send POST to:                            â† HTTP POST /api/video/upload
   - Endpoint: http://localhost:8000/api/video/upload
   - Body: FormData with video file
   â”‚
   â”‚                                    â†’ 1. Validate file type (must be video)
   â”‚                                         â”‚
   â”‚                                         â”‚ 2. Generate unique task_id (8-char UUID)
   â”‚                                         â”‚
   â”‚                                         â”‚ 3. Save video to temp directory:
   â”‚                                         â”‚    /temp_videos/{task_id}_original.mp4
   â”‚                                         â”‚
   â”‚                                         â”‚ 4. Extract first frame â†’ create base64 preview
   â”‚                                         â”‚
   â”‚                                         â”‚ 5. Store task info in processing_tasks dict
   â”‚                                         â”‚
   â”‚                                    â† 6. Return response with task_id and preview:
   â”‚                                       {
   â”‚                                         "task_id": "abc123de",
   â”‚                                         "preview": "data:image/jpeg;base64,...",
   â”‚                                         "filename": "video.mp4",
   â”‚                                         "message": "Video uploaded successfully"
   â”‚                                       }
   â”‚
5. Receive response â†’
   â”‚
6. Update state with task_id and preview
   â”‚
7. User clicks "Process Video"
   â”‚
8. Send POST to:                            â† HTTP POST /api/video/process/{task_id}
   - Endpoint: http://localhost:8000/api/video/process/{task_id}
   â”‚
   â”‚                                    â†’ 1. Verify task exists and not already processing
   â”‚                                         â”‚
   â”‚                                         â”‚ 2. Start background task
   â”‚                                         â”‚    (FastAPI BackgroundTasks)
   â”‚                                         â”‚
   â”‚                                    â† 3. Return immediate response:
   â”‚                                       {"message": "Processing started"}
   â”‚
9. Start polling status every 2 seconds
   â”‚
10. Send GET to:                            â† HTTP GET /api/video/status/{task_id}
    - Endpoint: http://localhost:8000/api/video/status/{task_id}
    â”‚
    â”‚                                    â†’ 1. Check processing_tasks dict
    â”‚                                         â”‚
    â”‚                                         â”‚ 2. Return current status:
    â”‚                                         â”‚    - If "processing": progress %
    â”‚                                         â”‚    - If "completed": full results
    â”‚                                         â”‚    - If "error": error message
    â”‚
    â”‚                                    â† 3. Status response varies:
    â”‚                                       "uploaded" state:
    â”‚                                       {
    â”‚                                         "task_id": "...",
    â”‚                                         "status": "uploaded",
    â”‚                                         "progress": 0,
    â”‚                                         "preview": "...",
    â”‚                                         "filename": "..."
    â”‚                                       }
    â”‚
    â”‚                                       "processing" state:
    â”‚                                       {
    â”‚                                         "task_id": "...",
    â”‚                                         "status": "processing",
    â”‚                                         "progress": 45,  // percentage
    â”‚                                         "preview": "..."
    â”‚                                       }
    â”‚
    â”‚                                       "completed" state:
    â”‚                                       {
    â”‚                                         "task_id": "...",
    â”‚                                         "status": "completed",
    â”‚                                         "output_path": "...",
    â”‚                                         "stream_url": "...",
    â”‚                                         "processed_preview": "data:image/jpeg;base64,...",
    â”‚                                         "fire_detected": true/false,
    â”‚                                         "smoke_detected": true/false,
    â”‚                                         "download_url": "...",
    â”‚                                         "frame_count": 1500,
    â”‚                                         "duration": 50.5,
    â”‚                                         "detection_count": 234
    â”‚                                       }
    â”‚
11. When status = "completed":
    - Stop polling
    - Update state with results
    - Show detection alerts
    - Display processed video preview
    â”‚
12. User can:
    - View processed preview image
    - Stream processed video
    - Download processed video

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
BACKGROUND PROCESSING (process_video_task function)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Load YOLO model once
   â”‚
2. Open video file:
   - Get FPS (default to 30 if 0)
   - Get width/height
   â”‚
3. Create output video writer:
   - Codec: mp4v
   - Same FPS, width, height as input
   â”‚
4. Process each frame:
   â”‚
   â”œâ”€ For each frame:
   â”‚  â”œâ”€ Run YOLO inference
   â”‚  â”œâ”€ Extract detections (fire/smoke)
   â”‚  â”œâ”€ Update detection counters
   â”‚  â”œâ”€ Save first frame with detections for preview
   â”‚  â”œâ”€ Draw bounding boxes on frame
   â”‚  â””â”€ Write frame to output video
   â”‚
   â”œâ”€ Update progress percentage:
   â”‚  progress = (current_frame / total_frames) * 100
   â”‚
   â””â”€ After all frames:
      - Close video files
      - Create processed preview from first detected frame
      - Update task status to "completed"
      - Store all metadata

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
KEY FEATURES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Asynchronous Processing: Uses BackgroundTasks for non-blocking processing
â€¢ Progress Tracking: Real-time progress percentage updates
â€¢ State Persistence: Tasks stored in memory (processing_tasks dict)
â€¢ Preview Images: Both original and processed first frames as base64
â€¢ Dual Access: Stream for playback + download for saving
â€¢ Comprehensive Metadata: Frame count, duration, detection counts
â€¢ Error Handling: Graceful error states and recovery
â€¢ Resume Capability: Frontend can resume monitoring if page reloaded
â€¢ Temporary Storage: Files stored in /temp_videos/ directory

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
DIFFERENCES FROM IMAGE DETECTION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Multi-step process: Upload â†’ Process â†’ Results (vs single step for images)
â€¢ Background processing: Can take minutes for long videos
â€¢ Progress tracking: Real-time updates via polling
â€¢ Video streaming: Special endpoints for playback
â€¢ Frame-by-frame analysis: Processes every video frame
â€¢ State in memory: Backend stores tasks in dict (not persistent)
â€¢ Preview extraction: Creates preview images from video
